<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>NeuraScope – 日本語論文リーダー</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/modern-css-reset/dist/reset.min.css">
<style>
 /* layout -------------------------------------------------- */
 body{font-family:system-ui,sans-serif;margin:0}
 #toc{position:fixed;left:0;top:0;height:100vh;width:240px;padding:1rem;
      background:#f4f4f4;border-right:1px solid #ddd;overflow-y:auto}
 #content{margin-left:260px;padding:2rem}
 #toc h2{font-size:1.1rem;margin:.25rem 0 .75rem}
 #toc ul{list-style:none;margin:0;padding:0;font-size:.9rem}
 #toc li{margin:.25rem 0}

 /* paper card --------------------------------------------- */
 .paper{margin-block:1.5rem;padding:1rem;border:1px solid #ddd;border-radius:.75rem;position:relative}
 button.fav{position:absolute;top:.7rem;right:.7rem;background:none;border:none;font-size:1.5rem;cursor:pointer}
 .analysis h3{margin-top:1rem}
</style>
</head>
<body>

<!-- ---------- 左サイドバー（目次） ---------- -->
<nav id="toc">
  <h2>論文一覧</h2>
  <ul id="toc-list"><!-- JS で挿入 --></ul>
</nav>

<!-- ---------- メインコンテンツ ---------- -->
<div id="content">
  <h1>最新論文</h1>

  <nav>
    <a href="{{ url_for('index') }}"     class="{{ 'active' if not only_fav else '' }}">すべて</a>
    <a href="{{ url_for('favorites') }}" class="{{ 'active' if only_fav else '' }}">お気に入り</a>
  </nav>

  {% for p in papers %}
  <article class="paper" id="card-{{ p.id }}" data-id="{{ p.id }}">
    <button class="fav">{{ '★' if p.favorite else '☆' }}</button>

    <h2><a href="{{ url_for('paper_detail', paper_id=p.id) }}">{{ p.title_ja }}</a></h2>
    <p>
      <a href="{{ url_for('paper_detail', paper_id=p.id) }}">詳細ページへ</a>
      {% if p.pdf_url %}/ <a href="{{ p.pdf_url }}" target="_blank" rel="noopener">PDF</a>{% endif %}
    </p>

    <section class="analysis">{{ p.analysis_html | safe }}</section>
  </article>
  {% endfor %}
</div>

<!-- ---------- スクリプト ---------- -->
<script>
/* お気に入りトグル ------------------------------------ */
document.querySelectorAll("button.fav").forEach(btn=>{
  btn.onclick=async ()=>{
    const id=btn.closest("article").dataset.id,will=btn.textContent==="☆";
    const r=await fetch(`/api/favorite/${id}`,{
      method:"POST",headers:{"Content-Type":"application/json"},
      body:JSON.stringify({favorite:will})
    });
    if(r.ok)btn.textContent=will?"★":"☆";
  };
});

/* 目次自動生成 ---------------------------------------- */
(()=>{const list=document.getElementById("toc-list");
  document.querySelectorAll(".paper").forEach(card=>{
    const li=document.createElement("li"),a=document.createElement("a");
    a.href="#"+card.id;
    a.textContent=card.querySelector("h2").textContent;
    li.appendChild(a); list.appendChild(li);
  });
})();
</script>
</body></html>
